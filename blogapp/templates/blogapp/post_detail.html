{% extends 'blogapp/base.html' %}
{% load mptt_tags %}
{% block content %}
{% load static %}


<!-- POSTS -->
<div class="posts">
    {% if post.cover %}
    <img style="width: inherit; height: 50vh; object-fit: cover" src="{{ post.cover.url}}" alt="image">
    {% endif %}
    <div class="post_header">
        <div>
            <div>
                <div class="post_header_top_edit">
                    {% if post.author == user %}
                    <a class="far fa-edit font" href="{% url 'blogapp:post_edit' pk=post.pk %}"></a>
                    <a class="fas fa-trash-alt" href="{% url 'blogapp:post_remove' pk=post.pk %}"></a>
                    {% if not post.published_date %}
                    <a href="{% url 'blogapp:post_publish' pk=post.pk %}"><i class="far fa-paper-plane"></i></a>
                    {% endif %}
                    {% endif %}
                </div>
            </div>

            <div>
                {% if post.published_date %}
                <p>{{ post.published_date }}</p>
                {% endif %}
            </div>

            {% if user.is_authenticated  %}
            <h2>
                {{ post.title|capfirst }}
            </h2>
            {% endif %}
        </div>

        <div class="post_text font">
            <p>{{ post.text|linebreaksbr|capfirst }}</p>
        </div>
    </div>

    <!-- COMMENTS -->
    {% if post.published_date %}
    <div class="comments">
        <hr style="height: 1px;border:none;background-color:rgb(100, 100, 100);">

        <a href="{% url 'blogapp:add_comment_to_comment' pk=post.pk %} ">Add comment <i
                class="far fa-comment-alt"></i></a>

        <div class="comment">
            <ul style='list-style-type: none'>
                {% recursetree new_comments %}
                <li style='list-style-type: none; margin-top: 20px'>
                    <div style="display:flex; align-content:center; justify-content:space-between;
                     box-shadow: 0px 0px 20px 0px rgba(192, 192, 192, 0.5); border-radius: 10px; padding: 10px;">
                        <span class="small_avatar">
                            {% if post.author.avatar %}
                            <ul style='list-style-type: none'>
                                <img src="{{ post.author.avatar.url }}" alt="avatar">
                                {% else %}
                                <img src="{% static 'image/noavatar.jpg' %}" alt="no avatar">
                                {% endif %}
                        </span>

                        <span>
                            {% if post.author %}
                            {{ post.author.username }}
                            {% endif %}
                        </span>
                    </div>

                    <p>{{ node.text }}</p>

                    <a href="{% url 'blogapp:add_comment_to_comment' pk=post.pk redid=node.pk %}">Answer <i
                            class="far fa-comment-alt"></i></a>

                    {% if not node.is_leaf_node %}

                    <ul style='list-style-type: none'>
                        {{ children }}
                    </ul>
                    {% endif %}
                </li>
                {% endrecursetree %}
            </ul>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}